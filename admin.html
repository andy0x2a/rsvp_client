<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="RSVP">
    <meta name="keywords" content="wedding matt jen vancouver">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="src/css/main.css">
    <link rel="stylesheet" href="src/lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="src/lib/bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="src/css/wedding.css">
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="index.html">Jen and Matt</a>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li class=""><a href="index.html">Home</a></li>
                <li class="active"><a href="#">RSVP</a></li>
            </ul>

        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">


            <div class="jumbotron">
                <div class="container">
                    <span style="text-align: center"><h1></h1> </span>
                </div>
            </div>


            <div class="col-sm-10 row  loginDiv">
                <form name="pass" method="post" action="/#" id="pass">

                    <div class="col-sm-9 myInput">
                        <label for="adminPass">Password:</label>
                        <input id="adminPass" class="Input" type="password" name="adminPass" autocorrect="off"
                               autocapitalize="off"
                               placeholder="Password"/>
                        <span class="error hidden">Invalid password </span>
                    </div>
                    <div class="col-sm-9 myInput">
                        <a href="#" class="button btn btn-default" id="submitPass">
                            <span id="submitPassSpan">Login</span>
                        </a>
                    </div>
                </form>
            </div>
            <div class="adminDashboard">
                <div class="col-sm-9 myInput">
                    <a href="#" class="button btn btn-default" id="getAllRSVPs">
                        <span>View/Edit RSVPs</span>
                    </a>
                </div>
                <div class="col-sm-9 myInput">
                    <a href="#" class="button btn btn-default" id="getAllMeals">
                        <span>View/Edit Meal Choices</span>
                    </a>
                </div>

            </div>

            <div class="col-sm-10 adminMeal">

                <div>
                    <table id="tblMeal" class="table table-hover">

                        <thead>
                        <tr>
                            <th>id</th>
                            <th>Name</th>

                        </tr>
                        </thead>

                    </table>

                    <div class="col-sm-9 myInput">
                        <a href="#" class="button btn btn-default" id="addMeal">
                            <span>Add Meal</span>
                        </a>
                    </div>

                </div>
                <div class="row editMealRow">
                    <div class="col-sm-10 ">


                        <form name="mealEdit" method="post" action="/#" id="meal_edit">

                            <div class="col-sm-9 myInput ">
                                <label for="meal_id">ID:</label>
                                <input id="meal_id" class="Input readonly" readonly type="text" name="meal_id" autocorrect="off"
                                       autocapitalize="off"
                                       placeholder="ID"/>
                            </div>

                            <div class="col-sm-9 myInput ">
                                <label for="meal_name">Name:</label>
                                <input id="meal_name" class="Input " type="text" name="meal_name" autocorrect="off"
                                       autocapitalize="off"
                                       placeholder="Name"/>
                            </div>

                            <div class="col-sm-9 myInput">
                                <a href="#" class="button btn btn-default" id="submitEditMeal">
                                    <span id="edMeal">Submit Edit</span>
                                </a>
                            </div>
                            <div class="col-sm-9 myInput">
                                <a href="#" class="button btn btn-default" id="editCancelMeal">
                                    <span>Cancel</span>
                                </a>
                            </div>
                        </form>

                    </div>
                </div>

            </div>



            <div class="col-sm-10 adminConsole">

                    <div>
                        <table id="tbl" class="table table-hover">

                            <thead>
                            <tr>
                                <th>id</th>
                                <th>first Name</th>
                                <th>Last Name</th>
                                <th>phone Number</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Meal</th>
                                <th>Address</th>
                                <th>association</th>
                                <th>Notes</th>
                                <th>Plus One</th>
                                <th>Plus One Meal</th>
                                <th>Edit</th>
                            </tr>
                            </thead>

                        </table>


                    </div>

                <div class="row adminEditSingle">

                    <div class="col-sm-10">


                        <form name="signupEdit" method="post" action="/#" id="rsvp_edit">

                            <div class="col-sm-9 myInput ">
                                <label for="id">ID:</label>
                                <input id="id" class="Input readonly" readonly type="text" name="id" autocorrect="off"
                                       autocapitalize="off"
                                       placeholder="ID"/>
                            </div>


                            <div class="col-sm-9 myInput ">
                                <label for="firstName">First Name:</label>
                                <input id="firstName" class="Input" type="text" name="firstName" autocorrect="off"
                                       autocapitalize="off"
                                       placeholder="First Name"/>
                            </div>


                            <div class="col-sm-9 myInput">
                                <label for="lastName">Last Name:</label>
                                <input id="lastName" class="Input" type="text" name="lastName" autocorrect="off"
                                       autocapitalize="off"
                                       placeholder="Last Name"/>
                            </div>


                            <div class="col-sm-9 myInput">
                                <label for="contact">Phone #:</label>
                                <input id="contact" class="Input" type="text" name="contact" autocorrect="off"
                                       autocapitalize="off"
                                       placeholder="Phone Number"/>
                            </div>


                            <div class="col-sm-9 myInput">
                                <label for="address">Address:</label>
                    <textarea id="address" class="form-control" rows="3" name="address" autocorrect="off"
                              autocapitalize="off"
                              placeholder="Address"> </textarea>
                            </div>


                            <div class="col-sm-9 myInput">
                                <label for="email">Email:</label>
                                <input id="email" class="Input" type="email" name="email" autocorrect="off"
                                       autocapitalize="off"
                                       placeholder="Email"/>
                            </div>
                            <div class="col-sm-9 myInput">
                                <label for="association">Guest of:</label>

                                <div class="btn-group" id="association" role="group" aria-label="...">
                                    <button type="button" class="btn btn-default btn-assoc " id="brideAssoc">Bride
                                    </button>
                                    <button type="button" class="btn btn-default btn-assoc" id="bothAssoc">Both</button>
                                    <button type="button" class="btn btn-default btn-assoc" id="groomAssoc">Groom
                                    </button>
                                </div>

                            </div>


                            <div class="col-sm-9 myInput">
                                <label for="attendings">Attending:</label>

                                <div class="btn-group" id="attendings" role="group" aria-label="...">
                                    <button type="button" class="btn btn-default btn-attend active" id="yes">Yes
                                    </button>
                                    <button type="button" class="btn btn-default btn-attend" id="no">No</button>
                                </div>

                            </div>
                            <div class="col-sm-9 myInput">
                                <div class="form-group">
                                    <label for="menuSel">Menu:</label>
                                    <select class="form-control" id="menuSel">
                                    </select>
                                </div>
                            </div>


                            <div class="col-sm-9 myInput">
                                <label for="plusOne">Plus One:</label>

                                <div class="btn-group" id="plusOne" role="group" aria-label="...">
                                    <button type="button" class="btn btn-default btn-plus" id="plusYes">Yes</button>
                                    <button type="button" class="btn btn-default btn-plus active" id="plusNo">No
                                    </button>
                                </div>
                            </div>


                            <div class="col-sm-9 plusOne">

                                <div class="col-sm-9 myInput ">
                                    <label for="plusOneId">ID:</label>
                                    <input id="plusOneId" class="Input readonly" readonly type="text" name="id"
                                           autocorrect="off" autocapitalize="off"
                                           placeholder="ID"/>
                                </div>

                                <div class="col-sm-9 myInput">
                                    <label for="plusOneName">Plus One Name:</label>
                                    <input id="plusOneName" class="Input" type="text" name="plusOneName"
                                           autocorrect="off" autocapitalize="off"
                                           placeholder="Name"/>
                                </div>

                                <div class="col-sm-9 myInput">
                                    <div class="form-group">
                                        <label for="menuSelPlusOne">Menu:</label>
                                        <select class="form-control" id="menuSelPlusOne">
                                        </select>
                                    </div>
                                </div>
                            </div>


                            <div class="col-sm-9 myInput error">
                                <h2> Please fill out the entire form</h2>
                            </div>

                            <div class="col-sm-9 myInput">
                                <a href="#" class="button btn btn-default" id="submitEdit">
                                    <span>Submit Edit</span>
                                </a>
                            </div>
                            <div class="col-sm-9 myInput">
                                <a href="#" class="button btn btn-default" id="editCancel">
                                    <span>Cancel</span>
                                </a>
                            </div>
                        </form>

                    </div>
                </div>


            </div>

        </div>
    </div>
</div>

<script src="src/js/rest.js"></script>
<script src="src/js/vendor/jquery-2.1.3.js"></script>
<script src="src/js/vendor/jquery.cookie.js"></script>
<script src="src/js/vendor/jquery.jsontotable.js"></script>
<script src="src/lib/bootstrap/js/bootstrap.min.js"></script>
<script>

    var serverURL = "http://localhost:8080/";

    var adminPass;

    var allData;
    var allMeals;
    var allMealMap;

    var getMealName = function(mealId) {
        if (!allMealMap || !mealId) {return '';}
        return allMealMap[mealId];

    }
    var getListOnSuccess = function (data) {

        allData = data;
        $(".adminConsole").show();

        $(".tbdy").remove();
        var body = $('<tbody class="tbdy"></tbody>');

        $.each(data, function (i, item) {


            var plusOneInfoName = '';
            var plusOneInfoMeal = '';
            if (!!item.plusOneInfo) {
                plusOneInfoName = item.plusOneInfo.name;
                plusOneInfoMeal = getMealName(item.plusOneInfo.mealChoiceId );
            }
            var rowStr = '<tr>' +

                    '<td>' + item.id + '</td>' +
                    '<td>' + item.firstName + '</td>' +
                    '<td>' + item.lastName + '</td>' +
                    '<td>' + item.phoneNumber + '</td>' +
                    '<td>' + item.email + '</td>' +
                    '<td>' + item.statusId + '</td>' +
                    '<td>' + getMealName(item.mealId )+ '</td>' +
                    '<td>' + item.address + '</td>' +
                    '<td>' + item.association + '</td>' +
                    '<td>' + item.notes + '</td>' +
                    '<td>' + plusOneInfoName + '</td>' +
                    '<td>' + plusOneInfoMeal + '</td>' +
                    '<td> <a href="#" class="editIcon" id="edit_icon_' + item.id + '" ><img src="src/img/edit.png"/> </a></td>' +
                    '</row>';


            var row = $(rowStr);
            body.append(row);


        });
        $("#tbl").append(body);
        $(".editIcon").on('click', function (event) {
            event.preventDefault();
            var elem = $(event.target);
            console.log(elem);

            var id = $(event.target).parent('a').attr('id').substring(10);
            showDataFor(id);

            $("#submitEdit").on('click', submitEditedGuest);

        });
    };


    var submitEditedGuest = function () {


        $('.error').hide();
        var id = $('#id').val().trim();
        var firstName = $('#firstName').val().trim();
        var lastName = $('#lastName').val().trim();
        var email = $('#email').val().trim();
        var contact = $('#contact').val().trim();
        var address = $('#address').val().trim();
        var attending = attendingStatus;
        var menu = $('#menuSel option:selected').attr('id');


        var plusOneStatus = true;


        var isValid = true;

        isValid = firstName && lastName && email && contact && address && menu;


        var obj = {
            'firstName': firstName,
            'lastName': lastName,
            'email': email,
            'phoneNumber': contact,
            'address': address,
            'statusId': attending ? '1' : '0',
            'mealId': menu,
//               'plusOneStatus' : plusOneStatus,
            'notes': '',
            'association': association,
            'id': id
        };


        if (plusOneStatus) {
            var plusOneName = $('#plusOneName').val().trim();
            var meal = $('#menuSelPlusOne option:selected').attr('id');
            var plusOneInfo = {
                'name': plusOneName,
                'mealChoiceId': meal,
                'id': plusOneId
            }
            obj.plusOneInfo = plusOneInfo;
        }

        verb = "PUT";

        var onComplete = function (a, b, c) {
            console.log('success');
            $('.adminEditSingle').hide();

        }

        var onError = function (a, b, c) {
            console.log('failed');
        }
        if (isValid) {
            console.log('submitting');
            var verb = "POST";
            var url = serverURL + "admin/guest/" + obj.id;
            if (isEdit) {

            }
            callAjax(url, verb,obj, onComplete, onError);

        } else {
            $('.error').show();
        }
        console.log(JSON.stringify(obj));


    }


    //$('#customers').tableExport({type:'excel',escape:'false'});


    var showDataFor = function (id) {

        var foundElem;
        $.each(allData, function (i, item) {
            if (item.id == id) {
                foundElem = item;
                return;
            }
        });
        if (foundElem) {
            $(".adminEditSingle").show();


            console.log('need to fill out variables here');

            $('#id').val(foundElem.id);
            $('#firstName').val(foundElem.firstName);
            $('#lastName').val(foundElem.lastName);
            $('#email').val(foundElem.email);
            $('#contact').val(foundElem.phoneNumber);
            $('#address').val(foundElem.address);
            if (foundElem.statusId == 1) {
                $("#yes").click();
            } else {
                $("#no").click();
            }
            if (foundElem.association === "bride") {
                $('#brideAssoc').click();
            } else if (foundElem.association === "groom") {
                $('#groomAssoc').click();
            } else {
                $('#bothAssoc').click();
            }

            $('#menuSel').val(foundElem.mealId);

            if (foundElem.plusOneInfo) {
                $('#plusYes').click();
                plusOneId = foundElem.plusOneInfo.id;
                $('#menuSelPlusOne').val(foundElem.plusOneInfo.mealChoiceId);
                $('#plusOneName').val(foundElem.plusOneInfo.name);
                $('#plusOneId').val(foundElem.plusOneInfo.id);
            }


        }
    }
    var getListOnError = function (data) {


        $(".adminConsole").hide();
        $(".error").removeClass('hidden');
    };

    var getListOfMealsOnSuccess = function (data) {

        $(".adminMeal").show();

        allMeals = data;

        $(".tbdyMeal").remove();
        var body = $('<tbody class="tbdyMeal"></tbody>');

        $.each(data, function (i, item) {



            var rowStr = '<tr>' +

                    '<td>' + item.id + '</td>' +
                    '<td>' + item.name + '</td>' +
                    '<td> <a href="#" class="editIconMeal" id="edit_meal_' + item.id + '" ><img src="src/img/edit.png"/> </a></td>' +
                    '</row>';
            var row = $(rowStr);
            body.append(row);


        });
        $("#tblMeal").append(body);
        $(".editIconMeal").on('click', function (event) {
            event.preventDefault();
            var elem = $(event.target);
            console.log(elem);

            var id = $(event.target).parent('a').attr('id').substring(10);
            showMealDataFor(id);

            $("#submitMealEdit").on('click', submitEditMeal);

        });
    };

    var showMealDataFor = function(id) {

        var meal = allMealMap[id];
        if (meal) {

            $('#meal_id').val(id);
           $('#meal_name').val(meal);


            $('.editMealRow').show();
            $('.edMeal').text('Edit Meal');
        }
    }
    var submitEditMeal = function() {
        var id = $('#meal_id').val().trim();
        var name = $('#meal_name').val().trim();
        var obj = {
            'id':id,
            'name':name
        }
        var url = serverURL + "admin/meal/";
        var verb = "POST";
        if (id) {
            verb = "PUT";
            url = url + id;
        }

        var onSuccess = function () {
            $(".editMealRow").hide();
            getListOfMeals(getListOfMealsOnSuccess, getListOnError);
        }
        adminCallAjax(url,verb,obj,onSuccess, null);

    }

    var getListOfMeals = function(onSuccess, onError) {
        callAjax(serverURL + "meal/", "GET", null, onSuccess, onError);
    }
    var getList = function () {
        callAjax(serverURL + "admin/guests", "GET", null, getListOnSuccess, getListOnError);
    }

    var prePopMealList =  function(data) {

        allMeals = data;

        allMealMap = {};
        for(var i = 0; i < data.length; i++) {
            var obj = data[i];

            allMealMap[obj.id] = (obj.name);

        }
        console.log('check here');
    };

    var hideAll = function() {
        $(".adminConsole").hide();
        $('.editMealRow').hide();
        $(".adminEditSingle").hide();
        $('.adminMeal').hide();

    }
    $(document).ready(function () {
        $(".adminDashboard").hide();
        hideAll();
        $("#getAllRSVPs").on('click', function () {
                    hideAll();
                    console.log(adminPass);
                    $(".error").addClass('hidden');
                    getList();
                }
        );


        getListOfMeals(prePopMealList);
        $("#getAllMeals").on('click', function() {
            hideAll();
            getListOfMeals(getListOfMealsOnSuccess);
        })
        $("#adminPass").keyup(function(e) {
            if (e.keyCode == 13) {
                event.preventDefault();
                $("#submitPass").click();
            }
        });
        $("#adminPass").keydown(function(e) {
            if (e.keyCode == 13) {
                event.preventDefault();
                $("#submitPass").click();
            }
        });

        $('#addMeal').on('click', function() {
        $('.editMealRow').show();
            $('.edMeal').text('Add Meal');
        });

        $('#submitEditMeal').on('click', function() {
            submitEditMeal();
            });

        $("#editCancel").on('click', function() {
            $(".adminEditSingle").hide();
        });
        $("#submitPass").on('click', function (e) {
            adminPass = $("#adminPass").val().trim();

            adminCallAjax(serverURL + "admin/login/", "GET", null, function () {
                $(".adminDashboard").show();
                $(".loginDiv").hide();
            },function () {
                alert('Invalid Password');
            });




        });

    });


</script>
</body>
</html>
